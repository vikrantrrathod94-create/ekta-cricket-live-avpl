async function api(path, method='GET', body, isForm){ const opts = { method, headers:{} }; if(isForm){ opts.body = body; } else { opts.headers['Content-Type']='application/json'; opts.body = body?JSON.stringify(body):undefined; } const res = await fetch('/api'+path, opts); return res.json(); } async function loadTeams(){ const res = await fetch('/api/public'); const j = await res.json(); const teams = j.teams || []; const sel = document.getElementById('teamSelect'); sel.innerHTML = '<option value="">Select team</option>' + teams.map(t=>`<option value="${t.id}">${t.name}</option>`).join(''); document.getElementById('createTeamA').innerHTML = teams.map(t=>`<option value="${t.id}">${t.name}</option>`).join(''); document.getElementById('createTeamB').innerHTML = teams.map(t=>`<option value="${t.id}">${t.name}</option>`).join(''); document.getElementById('teamsList').innerHTML = teams.map(t=>`<div>${t.name}</div>`).join('')||'No teams'; } document.getElementById('teamForm').addEventListener('submit', async function(e){ e.preventDefault(); const f = new FormData(e.target); const j = await api('/admin/addTeam','POST',f,true); document.getElementById('teamsList').innerText = j.ok ? 'Team added' : JSON.stringify(j); loadTeams(); }); document.getElementById('playerForm').addEventListener('submit', async function(e){ e.preventDefault(); const f = new FormData(e.target); const j = await api('/admin/addPlayer','POST',f,true); document.getElementById('playersListAdmin').innerText = j.ok ? 'Player added' : JSON.stringify(j); }); async function createMatch(){ const teamAId = document.getElementById('createTeamA').value; const teamBId = document.getElementById('createTeamB').value; const overs = document.getElementById('overs').value; const j = await api('/admin/createMatch','POST',{teamAId,teamBId,overs}); document.getElementById('matchResp').innerText = j.ok ? 'Match created' : JSON.stringify(j); } async function startInnings(){ const battingTeam = document.getElementById('batTeamSelect').value; const j = await api('/admin/startInnings','POST',{battingTeam}); alert(j.ok ? 'Innings started' : JSON.stringify(j)); } async function addBall(){ const runs = document.getElementById('bruns').value; const isWicket = document.getElementById('bwicket').checked; const extra = document.getElementById('bextra').value; const j = await api('/admin/addBall','POST',{runs,isWicket,extra}); document.getElementById('ballResp').innerText = j.ok ? 'Ball added' : JSON.stringify(j); } loadTeams();
